{% set title = 'Mes démarches' %}
{% extends 'base.html.twig' %}

{% block body %}
<section class="navbar-week">
	<div class="tabs is-fullwidth">
		<ul>

			{% for week in listOfWeeks %}
			<li>
				<a href=" {{path('app_user_steps_index', parameters={day : week|date('m/d/Y')})}}">
					du {{ week
					|format_datetime(locale='fr',pattern="dd MMM") }} <br>
					au {{week
					|date_modify('next sunday')
					|format_datetime(locale='fr',pattern="dd MMM") }}
				</a>
			</li>
			{% endfor %}
		</ul>
	</div>
</section>

<section class='container'>

	<div class="columns is-multiline mt-2">
		{% for stepsByDay in stepsByDays %}
		<div class="column is-6">
			<div class="box">
				<div class="columns">
					<div class="column is-8">
						<h3 class="title is-size-6">
							{{stepsByDay.date|format_datetime(locale='fr',pattern="EEEE dd MMMM")}}
						</h3>
						{% if stepsByDay.steps is not empty %}
						<p class="subtitle is-size-6">
							{{stepsByDay.steps|length}}
							démarche(s) réalisée(s)
						</p>
						{% endif %}
					</div>
					<div class="column">
						<a class="button is-small"
							href="{{ path('app_user_steps_new', parameters = {'selected_date'  : stepsByDay.date}) }}">
							Ajouter une démarche
						</a>
					</div>
				</div>
				{% if stepsByDay.steps is not empty %}

				<table class="table is-fullwidth">
					<thead>
						<tr>
							<th>Catégorie</th>
							<th>Durée</th>
							<th>Commentaire</th>
							<th>Action</th>

						</tr>
					</thead>
					<tbody>

						{% for step in stepsByDay.steps %}
						<tr>
							<td title="{{ step.step.name }}">
								{{ step.step.name|length > 20 ? step.step.name|slice(0, 20) ~ '...' : step.step.name}}
							</td>
							<td>
								{{step.duration|date('H') }}h{{step.duration|date('i') }}
							</td>
							<td title="{{ step.comment }}">
								{{ step.comment|length > 4 ? step.comment|slice(0, 4) ~ '...' : step.comment}}
							</td>
							<td class="has-text-centered">
								<a class="button is-small" href="{{ path('app_user_steps_edit', { id: step.id }) }}">
									<span class="icon is-small">
										<i class="fa fa-pencil" aria-hidden="true"></i>
									</span>
								</a>
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
				{% else %}
				<p>Pas de démarches, <a class="link"
						href="{{ path('app_user_steps_new', parameters = {'selected_date'  : stepsByDay.date}) }}">
						en ajouter ?
					</a></p>
				{% endif %}
			</div>
		</div>
		{% endfor %}
		<div class="column is-6">
			<div class="box">
				<h3 class="title has-text-centered is-size-6">Total</h3>

				<table class="table is-fullwidth">
					<thead>
						<tr>
							<th>Jour</th>
							<th>Catégorie</th>
							<th>Durée</th>
						</tr>
					</thead>
					<tbody>
						{% for day in stepsByDays %}

						<tr>
							<td>
								{{day.date|format_datetime('full', 'none', locale='fr')|split(' ')|first|
								capitalize}}
							</td>
							<td>
								{% for step in day.steps %}
								{{ step.step.name|length > 20 ? step.step.name|slice(0, 20) ~ '...' :
								step.step.name}}
								<br>

								{% endfor %}
							</td>
							<td>
								{% if day.total_duration.minutes != 0 and day.total_duration.hours != 0 %}
								{{day.total_duration.hours }}h{{day.total_duration.minutes }}
								{% endif %}
							</td>


						</tr>
						{% endfor %}

					</tbody>
				</table>
			</div>
		</div>
	</div>
</section>
{% endblock %}